define(["exports","jquery","websockets/binary_websockets","windows/windows","common/rivetsExtra","lodash","moment","navigation/navigation","text!realaccount/realaccount.html","../common/common","css!realaccount/realaccount.css","../common/util"],function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){return a&&a.__esModule?a:{"default":a}}function l(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var m=k(b),n=k(c),o=k(d),p=k(e),q=k(f),r=k(g),s=k(i),t=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},u=null,v=null,w=null,x=function(a){m["default"].growl.error({message:a.message})},y=function(a){return Object.values(a).some(function(a){return""===a})},z=a.init=function(a){w=a,a.click(function(){u?u.moveToTop():h.getLandingCompany().then(function(a){return A(s["default"],a)})["catch"](x)})},A=function(a,b){a=m["default"](a).i18n();var c={"upgrade-mlt":"Real Money Account Opening".i18n(),"upgrade-mf":"Financial Account Opening form".i18n(),"new-account":"New Account".i18n()}[b];u=o["default"].createBlankWindow(a,{title:c,resizable:!1,collapsable:!1,minimizable:!0,maximizable:!1,width:380,height:400,close:function(){u.dialog("destroy"),u.trigger("dialogclose"),u.remove(),u=null},open:function(){},destroy:function(){v&&v.unbind(),v=null},"data-authorized":"true"}),B(a,b),u.dialog("open");var d=u.dialog("widget").offset();d.top=110,u.dialog("option","position",{my:d.left,at:d.top}),u.dialog("widget").css({left:d.left+"px",top:d.top+"px"})},B=function(a,b){var c={route:{value:"user"},empty_fields:{validate:!1,clear:q["default"].debounce(function(){c.empty_fields.validate=!1},4e3),show:function(){c.empty_fields.validate=!0,c.empty_fields.clear()}},what_todo:b,input_disabled:!1,risk:{visible:!1},user:{disabled:!1,accepted:"upgrade-mf"===b,pep:!1,salutation:"Mr",salutation_array:["Mr","Mrs","Ms","Miss"],account_opening_reason_array:["Speculative","Income Earning","Hedging"],account_opening_reason:"",first_name:"",last_name:"",date_of_birth:"",yearRange:"-100:+0",showButtonPanel:!1,residence:"-",residence_name:"-",address_line_1:"",address_line_2:"",city_address:"",state_address:"-",state_address_array:[{text:"-",value:"-"}],address_postcode:"",phone:"",secret_question_inx:5,secret_question_array:["Mother's maiden name","Name of your pet","Name of first love","Memorable town/city","Memorable date","Favourite dish","Brand of first car","Favourite artist"],secret_answer:"",place_of_birth:"",citizen:"",country_array:[{text:"-",value:"-"}],tax_residence:"",tax_identification_number:"",available_currencies:[]},financial:{accepted:!1,disabled:!1,professional_client:{chk_professional:!1},trading_experience:{forex_trading_experience:"",forex_trading_frequency:"",binary_options_trading_experience:"",binary_options_trading_frequency:"",cfd_trading_experience:"",cfd_trading_frequency:"",other_instruments_trading_experience:"",other_instruments_trading_frequency:""},financial_information:{income_source:"",employment_status:"",employment_industry:"",occupation:"",source_of_wealth:"",education_level:"",net_income:"",estimated_worth:"",account_turnover:""},trading_experience_select_data:t({},j.financial_account_opening.trading_experience_select_data),financial_information_select_data:t({},j.financial_account_opening.financial_information_select_data)},binary_url_contact:getBinaryUrl("contact.html"),binary_url_tc:getBinaryUrl("terms-and-conditions.html")};c.input_disabled=local_storage.get("oauth").reduce(function(a,b){return a||/MLT/.test(b.id)},!1)&&"upgrade-mf"===b,c.user.is_valid=function(){var a=c.user;return""!==c.user.account_opening_reason&&""!==a.first_name&&!/[~`!@#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\",<>?\/\d]/.test(a.first_name)&&""!==a.last_name&&!/[~`!@#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\",<>?\/\d]/.test(a.last_name)&&r["default"](a.date_of_birth,"YYYY-MM-DD",!0).isValid()&&""!==m["default"].trim(c.user.place_of_birth)&&""!==m["default"].trim(c.user.citizen)&&"-"!==a.residence&&""!==a.address_line_1&&!/[~`!#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\"<>?]/.test(a.address_line_1)&&!/[~`!#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\"<>?]/.test(a.address_line_2)&&""!==a.city_address&&!/[~`!@#\$%\^\&\*\(\)\+=\{\}\[\]\\|:;\",<>?\/\d]/.test(a.city_address)&&/^[^+]{0,20}$/.test(a.address_postcode)&&""!==a.phone&&/^\+?[0-9\s]{6,35}$/.test(a.phone)&&(c.input_disabled||/.{4,8}$/.test(a.secret_answer))&&("upgrade-mf"!=c.what_todo||c.user.tax_residence&&c.user.tax_identification_number&&/^[\w-]{0,20}$/.test(c.user.tax_identification_number))},c.user.click=function(){return c.user.is_valid()?"upgrade-mlt"===c.what_todo?void c.user.new_account_real():void c.route.update("financial"):void c.empty_fields.show()},c.user.new_account_real=function(){var a=c.user,b={new_account_real:1,salutation:a.salutation,first_name:a.first_name,last_name:a.last_name,account_opening_reason:a.account_opening_reason,date_of_birth:a.date_of_birth,place_of_birth:a.place_of_birth,citizen:a.citizen,residence:a.residence,address_line_1:a.address_line_1,address_line_2:a.address_line_2||void 0,address_city:a.city_address,address_state:a.state_address||void 0,address_postcode:a.address_postcode||void 0,phone:a.phone,secret_question:a.secret_question_array[a.secret_question_inx],secret_answer:a.secret_answer.replace('""',"'")};c.user.disabled=!0,n["default"].send(b).then(function(a){c.user.disabled=!1;var b=a.new_account_real,d=local_storage.get("oauth");return d.push({id:b.client_id,token:b.oauth_token,is_virtual:0}),local_storage.set("oauth",d),m["default"].growl.notice({message:"Account successfully created"}),m["default"].growl.notice({message:"Switching to your new account ..."}),n["default"].switch_account(b.client_id).then(function(){u&&u.dialog("close"),w.hide()})})["catch"](function(a){c.user.disabled=!1,x(a)})},c.user.pep_window=function(a){a.preventDefault();var b="A Politically Exposed Person (PEP) is an individual who is or has been entrusted with a prominent public function including his/her immediate family members or persons known to be close associates of such persons, but does not include middle ranking or more junior officials.<br><br>\n         Such individuals include Heads of State, Ministers, Parliamentary Secretaries, Members of Parliament, Judges, Ambassadors, Senior Government Officials, High Ranking Officers in the Armed Forces, Audit Committees of the boards of central banks, and Directors of state-owned corporations.<br><br>\n         The “immediate family members” of the above examples will also be considered as PEP, and these include their spouses/partners, parents, and children. Additionally, “persons known to be close associates” of PEPs include their business partners, will also be considered as such.<br><br>\n         As a general rule, a person considered to be a PEP and who has ceased to be entrusted with a prominent public function for a period of at least twelve months no longer qualifies as a PEP.";o["default"].createBlankWindow('<div style="padding:15px;">'+b+"</div>",{title:"PEP",modal:!0,resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,closeOnEscape:!0,width:500,height:"auto"}).dialog("open")},c.user.professional_window=function(a){a.preventDefault();var b="Clients need to satisfy at least two of the following criteria in order to receive Professional Client status:",c=["You’ve carried out significant transactions on markets similar to the ones we offer, averaging 10 transactions per quarter for the previous four quarters","The size of your instrument portfolio exceeds EUR 500,000 or its equivalent","You’ve worked in the financial sector for at least one year in a role that requires knowledge of your intended transactions on our platform"],d="If you choose to be treated as a Professional Client, we’ll regard you as having the required market knowledge and experience. As such, we’ll take steps to ensure that your request for Professional Client status meets the above criteria, including a request for the following:",e=["Statements that reflect your transactions from the previous four quarters","Proof of your portfolio held elsewhere","Proof of your employment"];o["default"].createBlankWindow('<div style="padding:15px;">\n      <div>'+b+'</div>\n      <ul class="checked">\n            <li>'+c[0]+"</li>\n            <li>"+c[1]+"</li>\n            <li>"+c[2]+"</li>\n      </ul>\n      <div>"+d+'</div>\n      <ul class="bullet">\n            <li>'+e[0]+"</li>\n            <li>"+e[1]+"</li>\n            <li>"+e[2]+"</li>\n      </ul>\n      </div>",{title:"Professional Client",modal:!0,resizable:!1,collapsable:!1,minimizable:!1,maximizable:!1,closeOnEscape:!0,width:600,height:"auto"}).dialog("open")},c.financial.click=function(){return y(c.financial.trading_experience)?(c.empty_fields.show(),void m["default"].growl.error({message:"Not all trading experiences are completed"})):y(c.financial.financial_information)?(c.empty_fields.show(),void m["default"].growl.error({message:"Not all financial information are completed"})):c.financial.accepted?void(c.risk.visible=!0):void m["default"].growl.error({message:"Binary.com terms and conditions unchecked."})},c.financial.create_request=function(){var a=c.user,b=t({new_account_maltainvest:1,salutation:a.salutation,first_name:a.first_name,account_opening_reason:a.account_opening_reason,last_name:a.last_name,date_of_birth:a.date_of_birth,residence:a.residence,address_line_1:a.address_line_1,address_line_2:a.address_line_2||void 0,address_city:a.city_address,address_state:a.state_address||void 0,address_postcode:a.address_postcode||void 0,phone:a.phone,place_of_birth:c.user.place_of_birth,citizen:c.user.citizen,tax_residence:c.user.tax_residence.join(","),tax_identification_number:c.user.tax_identification_number,affiliate_token:"",client_type:c.financial.professional_client.chk_professional?"professional":"retail"},c.financial.financial_information,c.financial.trading_experience,{accept_risk:1});return b},c.financial.new_account_maltainvest=function(){c.financial.create_request()},c.risk.accept=function(){var a=c.financial.create_request();c.input_disabled||(a.secret_question=c.user.secret_question_array[c.user.secret_question_inx],a.secret_answer=c.user.secret_answer),c.risk.visible=!1,c.financial.disabled=!0,n["default"].send(a).then(function(a){var b=a.new_account_maltainvest,c=local_storage.get("oauth");return c.push({id:b.client_id,token:b.oauth_token,is_virtual:0}),local_storage.set("oauth",c),m["default"].growl.notice({message:"Account successfully created"}),m["default"].growl.notice({message:"Switching to your new account ..."}),n["default"].switch_account(b.client_id).then(function(){u&&u.dialog("close"),w.hide()})})["catch"](function(a){c.financial.disabled=!1,x(a)})},c.risk.decline=function(){c.risk.visible=!1},c.route.update=function(a){c.route.value=a,"financial"===a&&document.getElementById("financial_second_page").scrollIntoView(),u.dialog("widget").trigger("dialogresizestop")},c.set_account_opening_reason=function(){var a={set_settings:1};a.account_opening_reason=c.user.account_opening_reason,c.user.disabled=!0,n["default"].send(a).then(function(){c.user.show_account_opening_reason=!1})["catch"](function(a){x(a),c.user.disabled=!1})},c.create_new_account=function(a){var b={new_account_real:1,salutation:c.user.salutation||"",first_name:c.user.first_name||"",last_name:c.user.last_name||"",date_of_birth:c.user.date_of_birth||"",address_line_1:c.user.address_line_1||"",address_line_2:c.user.address_line_2||"",address_city:c.user.city_address||"",address_state:c.user.state_address||"",address_postcode:c.user.address_postcode||"",phone:c.user.phone||"",account_opening_reason:c.user.account_opening_reason,residence:c.user.residence};n["default"].send(b).then(function(b){var c=b.new_account_real,d=local_storage.get("oauth");return d.push({id:c.client_id,token:c.oauth_token,currency:a,is_virtual:0}),local_storage.set("oauth",d),m["default"].growl.notice({message:"Account successfully created"}),m["default"].growl.notice({message:"Switching to your new account ..."}),n["default"].switch_account(c.client_id).then(function(){n["default"].send({set_account_currency:a}).then(function(){local_storage.set("currency",a),window.location.reload(),u&&u.dialog("close"),w.hide()})})})["catch"](function(a){x(a),u&&u.dialog("close"),w.hide()})},v=p["default"].bind(a[0],c);var d=n["default"].send({get_settings:1}).then(function(a){a=a.get_settings,c.user.salutation=a.salutation||c.user.salutation,c.user.first_name=a.first_name||"",c.user.last_name=a.last_name||"",c.user.account_opening_reason=a.account_opening_reason||"",c.user.date_of_birth=a.date_of_birth?r["default"].unix(a.date_of_birth).format("YYYY-MM-DD"):r["default"]().subtract(18,"years").format("YYYY-MM-DD"),c.user.address_line_1=a.address_line_1||"",c.user.address_line_2=a.address_line_2||"",c.user.city_address=a.address_city||"",c.user.state_address=a.address_state||"",c.user.address_postcode=a.address_postcode||"",c.user.phone=a.phone||"",c.user.residence=a.country_code||"",c.user.residence_name=a.country||"",c.user.show_account_opening_reason=""===c.user.account_opening_reason})["catch"](x);d.then(function(){return n["default"].cached.send({residence_list:1})}).then(function(a){var b=a.residence_list.findIndex(function(a){return a.text===c.user.residence_name});c.user.country_array=a.residence_list,c.user.place_of_birth=a.residence_list[b].value,c.user.citizen=a.residence_list[b].value;var d=q["default"].find(a.residence_list,{value:c.user.residence});c.user.phone=c.user.phone?c.user.phone:d.phone_idd?"+"+d.phone_idd:""})["catch"](x),d.then(function(){return n["default"].cached.send({states_list:c.user.residence})}).then(function(a){c.user.state_address_array=[{text:"Please select",value:""}].concat(l(a.states_list)),c.user.state_address=c.user.state_address_array[0].value})["catch"](x);var e=function(){var a=local_storage.get("authorize");n["default"].cached.send({landing_company_details:a.landing_company_name}).then(function(a){if(a.landing_company_details&&a.landing_company_details.legal_allowed_currencies){var b=a.landing_company_details.legal_allowed_currencies,d=local_storage.get("currencies_config")||{},e=q["default"].filter(loginids(),{is_cr:!0}),f=q["default"].some(e,{type:"fiat"});f||(c.user.available_currencies=b.filter(function(a){return d[a]&&"fiat"===d[a].type})),c.user.available_currencies=[].concat(l(c.user.available_currencies),l(q["default"].difference(b.filter(function(a){return d[a]&&"crypto"===d[a].type}),q["default"].filter(e,{type:"crypto"}).map(function(a){return a.currency||""}))))}})};"new-account"===b&&e()};a["default"]={init:z}});