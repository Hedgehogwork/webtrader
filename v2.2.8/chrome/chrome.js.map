{"version":3,"sources":["../../../../src/chrome/chrome.es6"],"names":["win","setTimeout","check","chrome_ls","local_storage","get","show","accepted_or_cancel_time","diff","moment","utc","valueOf","window","chrome","webstore","length","moveToTop","$html","html","i18n","windows","createBlankWindow","dialogClass","width","height","resizable","collapsable","minimizable","maximizable","modal","ignoreTileAction","find","on","dialog","install","set","append","workspace","events"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;;AAUA,OAAIA,MAAM,IAAV;AACA;AACAC,cAAW,YAAM;AACd;AACA,UAAMC,QAAQ,SAARA,KAAQ,GAAM;AACjB,aAAMC,YAAYC,cAAcC,GAAd,CAAkB,QAAlB,CAAlB;AACA,aAAKC,OAAO,CAACH,SAAb;;AAEA,aAAG,CAACG,IAAJ,EAAU;AACP,gBAAMC,0BAA0BJ,UAAUI,uBAA1C;AACAD,mBAAO,CAACC,uBAAR;AACA,gBAAI,CAACD,IAAL,EAAW;AACR,mBAAME,OAAQC,iBAAOC,GAAP,GAAaC,OAAb,KAAyBJ,uBAAvC;AACAD,sBAAQE,QAAS,IAAI,EAAJ,GAAS,EAAT,GAAc,EAAd,GAAmB,IAApC,CAFQ,CAEmC;AAC7C;AACH;AACD,gBAAOF,IAAP;AACF,OAbD;;AAeA,UAAMA,OAAOJ,OAAb;AACA,UAAII,QAAQM,OAAOC,MAAf,IAAyBA,OAAOC,QAAhC,IAA4C,sBAAE,mCAAF,EAAuCC,MAAvC,IAAiD,CAAjG,EAAoG;AACjG,aAAIf,GAAJ,EAAS;AACNA,gBAAIgB,SAAJ;AACA;AACF;AACD,aAAMC,QAAQ,sBAAEC,gBAAF,EAAQC,IAAR,EAAd;AACAnB,eAAMoB,kBAAQC,iBAAR,CAA0BJ,KAA1B,EACH;AACGK,yBAAa,gBADhB;AAEGC,mBAAO,GAFV;AAGGC,oBAAQ,GAHX;AAIGC,uBAAW,KAJd;AAKGC,yBAAa,KALhB;AAMGC,yBAAa,KANhB;AAOGC,yBAAa,KAPhB;AAQGC,mBAAO,IARV;AASGC,8BAAiB;AATpB,UADG,CAAN;;AAaAb,eAAMc,IAAN,CAAW,QAAX,EAAqBC,EAArB,CAAwB,OAAxB,EAAiC,YAAM;AACpChC,gBAAIiC,MAAJ,CAAY,OAAZ;AACApB,mBAAOC,QAAP,CAAgBoB,OAAhB;AACA9B,0BAAc+B,GAAd,CAAkB,QAAlB,EAA4B,EAAE5B,yBAA0BE,iBAAOC,GAAP,GAAaC,OAAb,EAA5B,EAA5B;AACF,UAJD;AAKAM,eAAMc,IAAN,CAAW,SAAX,EAAsBC,EAAtB,CAAyB,OAAzB,EAAkC,YAAM;AACrChC,gBAAIiC,MAAJ,CAAY,OAAZ;AACA7B,0BAAc+B,GAAd,CAAkB,QAAlB,EAA4B,EAAE5B,yBAA0BE,iBAAOC,GAAP,GAAaC,OAAb,EAA5B,EAA5B;AACF,UAHD;;AAKA;AACA,+BAAE,MAAF,EAAUyB,MAAV,CAAiBpC,IAAIiC,MAAJ,CAAW,QAAX,CAAjB;AACAjC,aAAIiC,MAAJ,CAAW,MAAX;AAEF;AACH,IApDD,EAoDG,IApDH;;AAsDA;AACAI,uBAAUC,MAAV,CAAiBN,EAAjB,CAAoB,MAApB,EAA4B,YAAM;AAC/B,UAAIhC,OAAOA,IAAIiC,MAAJ,CAAW,QAAX,CAAX,EAAiC;AAC9BjC,aAAIiC,MAAJ,CAAW,OAAX;AACAjC,aAAIgB,SAAJ;AACF;AACH,IALD;;qBAOe,E","file":"chrome.js","sourcesContent":["/**\n * Created by arnab on 5/6/16.\n */\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport workspace from '../workspace/workspace';\nimport moment from 'moment';\nimport '../common/util';\nimport html from 'text!./chrome.html';\n\nlet win = null;\n//Trigger after 1 second - Give the injector some time to inject the DOM element\nsetTimeout(() => {\n   //Display it with diminishing frequency. E.g. in a day after first cancel, in a week after second, then once a month.\n   const check = () => {\n      const chrome_ls = local_storage.get(\"chrome\");\n      let  show = !chrome_ls;\n\n      if(!show) {\n         const accepted_or_cancel_time = chrome_ls.accepted_or_cancel_time;\n         show = !accepted_or_cancel_time;\n         if (!show) {\n            const diff = (moment.utc().valueOf() - accepted_or_cancel_time);\n            show = (diff >= (7 * 24 * 60 * 60 * 1000));//if one week elapsed\n         }\n      }\n      return show;\n   };\n\n   const show = check();\n   if (show && window.chrome && chrome.webstore && $('#webtrader-extension-is-installed').length <= 0) {\n      if (win) {\n         win.moveToTop();\n         return;\n      }\n      const $html = $(html).i18n();\n      win = windows.createBlankWindow($html,\n         {\n            dialogClass: \"dialog-confirm\",\n            width: 350,\n            height: 150,\n            resizable: false,\n            collapsable: false,\n            minimizable: false,\n            maximizable: false,\n            modal: true,\n            ignoreTileAction:true\n         });\n\n      $html.find(\"#apply\").on(\"click\", () => {\n         win.dialog( 'close' );\n         chrome.webstore.install();\n         local_storage.set(\"chrome\", { accepted_or_cancel_time : moment.utc().valueOf() });\n      });\n      $html.find(\"#cancel\").on(\"click\", () => {\n         win.dialog( 'close' );\n         local_storage.set(\"chrome\", { accepted_or_cancel_time : moment.utc().valueOf() });\n      });\n\n      //This helps in showing multiple dialog windows in modal form\n      $('body').append(win.dialog('widget'));\n      win.dialog('open');\n\n   }\n}, 5000);\n\n/* Move to top if it's behind other dialogs */\nworkspace.events.on('tile', () => {\n   if (win && win.dialog('isOpen')) {\n      win.dialog('close');\n      win.moveToTop();\n   }\n});\n\nexport default {}\n"]}