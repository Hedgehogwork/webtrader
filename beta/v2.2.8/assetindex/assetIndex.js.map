{"version":3,"sources":["../../../../src/assetindex/assetIndex.es6"],"names":["table","assetWin","market_names","submarket_names","assets","markets","init","li","click","createBlankWindow","title","i18n","dialogClass","minWidth","minHeight","resizable","minimizable","maximizable","track","module_id","is_unique","data","dialog","require","initAssetWin","moveToTop","processMarketSubmarkets","extractFilteredMarkets","ret","filter","loginId","local_storage","get","loginid","test","eMarket","name","forEach","market","smarkets","display_name","submarkets","smarket","instruments","map","symbol","refreshTable","updateTable","market_name","submarket_name","symbols","rows","asset","indexOf","props","getRowValue","key","prop","chain","find","first","f","value","trim","push","api","remove","add","show","column","visible","draw","processing_msg","attr","Promise","all","cached","send","trading_times","Date","toISOString","slice","asset_index","then","results","header","parent","addClass","dialog_buttons","makeSelectmenu","insertBefore","list","Object","keys","inx","changed","val","update_list","width","selectmenu","is_rtl_language","hide","err","console","error","catch","growl","message","$html","appendTo","dataTable","className","paging","ordering","searching","processing","every","on","search","liveapi","events"],"mappings":"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","file":"assetIndex.js","sourcesContent":["ï»¿/**\n * Created by amin on October 19, 2015.\n */\nimport $ from 'jquery';\nimport windows from '../windows/windows';\nimport liveapi from '../websockets/binary_websockets';\nimport menu from \"../navigation/menu\";\nimport _ from \"lodash\";\nimport \"datatables\";\nimport \"jquery-growl\";\nimport 'css!./assetIndex.css';\n\nlet table = null;\nlet assetWin = null;\nlet market_names = null;\nlet submarket_names = null;\nlet assets = [];\nlet markets = {};\n\nexport const init = (li) => {\n    li.click(() => {\n        if (!assetWin) {\n            assetWin = windows.createBlankWindow($('<div/>'), {\n                title: 'Asset Index'.i18n(),\n                dialogClass: 'assetIndex',\n                minWidth: 800,\n                minHeight: 400,\n                resizable: false,\n                minimizable: true,\n                maximizable: true,\n            });\n            assetWin.track({\n                module_id: 'assetIndex',\n                is_unique: true,\n                data: null\n            });\n            assetWin.dialog('open'); /* bring window to front */\n            require(['text!assetindex/assetIndex.html'], initAssetWin);\n        } else\n            assetWin.moveToTop();\n    });\n}\n\nconst processMarketSubmarkets = (markets) => {\n    markets = menu.extractFilteredMarkets(markets);\n\n    const ret = {};\n    markets\n      .filter(eMarket => {\n        const loginId = (local_storage.get('authorize') || {}).loginid || '';\n        return (/MF/gi.test(loginId) && eMarket.name !== 'Volatility Indices')\n        || (/MLT/gi.test(loginId) && eMarket.name === 'Volatility Indices')\n        || (/MX/gi.test(loginId) && eMarket.name === 'Volatility Indices')\n        || (!/MF/gi.test(loginId) && !/MLT/gi.test(loginId) && !/MX/gi.test(loginId));\n      })\n      .forEach((market) => {\n        const smarkets = ret[market.display_name] = {};\n        market.submarkets.forEach((smarket) => {\n            smarkets[smarket.display_name] = smarket.instruments.map((symbol) => {\n                return symbol.display_name; });\n        });\n    });\n    return ret;\n}\n\nconst refreshTable = () => {\n    const updateTable = (market_name, submarket_name) => {\n        const symbols = markets[market_name][submarket_name];\n        const rows = assets\n            .filter((asset) => {\n                return symbols.indexOf(asset[1] /* asset.name */ ) > -1;\n            })\n            .map((asset) => {\n                /* secham:\n                    [ \"frxAUDJPY\",\"AUD/JPY\",\n                      [\n                        [\"callput\",\"callput\",\"5t\",\"365d\"],\n                        [\"touchnotouch\",\"Touch/No Touch\",\"1h\",\"1h\"],\n                        [\"endsinout\",\"endsinout\",\"1d\",\"1d\"],\n                        [\"staysinout\",\"staysinout\",\"1d\",\"1d\"]\n                      ]\n                    ]\n                    asset[0] = frxAUDJPY\n                    asset[1] = AUD/JPY\n                    asset[2] = [\"callput\",\"callput\",\"5t\",\"365d\"]\n                      prop[0] = callput\n                      prop[1] = callput\n                      prop[2] = 5t\n                      prop[3] = 365d\n                */\n                const props = [];\n                const getRowValue = (key) => {\n                  const prop = _.chain(asset[2]).find(f => _.first(f) === key).value() || [];\n                  return `${_.trim(prop[2])} - ${_.trim(prop[3])}`;\n                };\n                props.push(asset[1]);\n                props.push(getRowValue('lookback'));\n                props.push(getRowValue('callput'));\n                props.push(getRowValue('touchnotouch'));\n                props.push(getRowValue('endsinout'));\n                props.push(getRowValue('staysinout'));\n                props.push(getRowValue('digits'));\n                props.push(getRowValue('asian'));\n\n                return props;\n            });\n        table.api().rows().remove();\n        table.api().rows.add(rows);\n        // Show/Hide Lookback, Digits & Asians col based on market = Volatility Indices\n        const show = market_name.indexOf('Volatility Indices') !== -1;\n        table.api().column(1).visible(show);\n        table.api().column(6).visible(show);\n        table.api().column(7).visible(show);\n        table.api().draw();\n    }\n\n    const processing_msg = $('#' + table.attr('id') + '_processing').show();\n    Promise.all(\n            [\n                liveapi.cached.send({ trading_times: new Date().toISOString().slice(0, 10) }),\n                liveapi.cached.send({ asset_index: 1 }),\n            ])\n        .then((results) => {\n            try {\n              assets = results[1].asset_index;\n              markets = processMarketSubmarkets(results[0]);\n                const header = assetWin.parent().find('.ui-dialog-title').addClass('with-content');\n                const dialog_buttons = assetWin.parent().find('.ui-dialog-titlebar-buttonpane');\n\n                if (!market_names) {\n                  market_names = windows\n                      .makeSelectmenu($('<select />').insertBefore(dialog_buttons), {\n                          list: Object.keys(markets), //Keys are the display_name\n                          inx: 0, //Index to select the item in drop down\n                          changed: (val) => {\n                              const list = Object.keys(markets[val]); /* get list of sub_markets */\n                              submarket_names.update_list(list);\n                              updateTable(market_names.val(), submarket_names.val());\n                          },\n                          width: '180px'\n                      });\n                  market_names.selectmenu('widget').addClass('asset-index-selectmenu');\n                } else {\n                  market_names.update_list(Object.keys(markets));\n                }\n\n                const is_rtl_language = local_storage.get('i18n') && local_storage.get('i18n').value === 'ar';\n                if (!submarket_names) {\n                  submarket_names = windows\n                    .makeSelectmenu($('<select />').insertBefore(is_rtl_language ? market_names : dialog_buttons), {\n                        list: Object.keys(markets[market_names.val()]),\n                        inx: 0,\n                        changed: (val) => {\n                            updateTable(market_names.val(), submarket_names.val());\n                        },\n                        width: '200px'\n                    });\n                  submarket_names.selectmenu('widget').addClass('asset-index-selectmenu');\n                } else {\n                  submarket_names.update_list(Object.keys(markets[market_names.val()]));\n                }\n\n                updateTable(market_names.val(), submarket_names.val());\n                processing_msg.hide();\n            } catch (err) { console.error(err) }\n        })\n        .catch((error) => {\n            $.growl.error({ message: error.message });\n            console.error(error);\n        });\n}\n\nconst initAssetWin = ($html) => {\n    $html = $($html).i18n();\n    table = $html.filter('table');\n    $html.appendTo(assetWin);\n\n    table = table.dataTable({\n        data: [],\n        \"columnDefs\": [\n            { className: \"dt-body-center dt-header-center\", \"targets\": [0, 1, 2, 3, 4, 5, 6, 7] },\n            { \"defaultContent\": \"-\", \"targets\": [0, 1, 2, 3, 4, 5, 6, 7] }\n        ],\n        paging: false,\n        ordering: false,\n        searching: true,\n        processing: true\n    });\n    table.parent().addClass('hide-search-input');\n\n    // Apply the a search on each column input change\n    table.api().column(0).every(function() {\n        const column = this;\n        $('input', this.header()).on('keyup change', function() {\n            if (column.search() !== this.value)\n                column.search(this.value).draw();\n        });\n    });\n\n    refreshTable();\n    require(['websockets/binary_websockets'], (liveapi) => {\n      liveapi.events.on('login', refreshTable);\n      liveapi.events.on('logout', refreshTable);\n   });\n}\n\nexport default {\n    init\n}\n"]}