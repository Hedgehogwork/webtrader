{"version":3,"sources":["../../../../src/viewtransaction/viewTransaction.es6"],"names":["open_dialogs","DISPLAY_DECIMALS","NOTE_TEXT","EXPIRED","i18n","MARKET_RATE","NO_RESALE","FINISHED","require","market_data_disruption_win","show_market_data_disruption_win","proposal","moveToTop","market_disrupt_msg","root","createBlankWindow","title","height","resizable","collapsable","minimizable","maximizable","destroy","dialog","remove","window","dd","init_chart","state","options","data","type","decimal_digits","history","times","prices","i","length","push","Math","max","substring","indexOf","candles","map","c","epoch","open","high","low","close","el","find","chart_options","credits","href","text","chart","renderTo","backgroundColor","width","marginLeft","marginRight","tooltip","xDateFormat","valueDecimals","undefined","xAxis","categories","startOnTick","endOnTick","min","labels","overflow","format","yAxis","align","x","y","formatter","addComma","value","toFixed","series","name","exporting","enabled","enableImages","legend","navigator","plotOptions","line","marker","radius","candlestick","lineColor","color","upColor","upLineColor","shadow","rangeSelector","Highcharts","Chart","addPlotLineX","addPlotLine","id","label","text_left","zIndex","dashStyle","addPlotLineY","text_under","get_tick_value","symbol","send","ticks_history","granularity","style","start","end","count","catch","err","console","error","init","contract_id","transaction_id","Promise","resolve","reject","proposal_open_contract","then","underlying","shortcode","init_dialog","growl","message","handle_error","forget","echo_req","subscribe","update_indicative","contract","update_state","draw_chart","contract_has_finished","status","on_contract_finished","update_state_sell","handle_forward_starting","manual_reflow","user_sold","sell_spot_time","date_expiry","current_spot","current_spot_time","bid_price","entry_tick","entry_tick_time","is_sold","exit_tick","exit_tick_time","sell_price","is_valid_to_sell","barrier","high_barrier","low_barrier","note","make_note","sell","toString","split","unit","cent","constract_is_forward_starting","is_forward_starting","date_start","fwd_starting","draw_sparkline","draw_vertical_lines","draw_barrier","draw_entry_spot","draw_start_time","draw_exit_spot","draw_end_time","chart_has_label","contract_has_no_exit_time","is_path_dependent","added_labels","includes","is_ended","validation_error","is_expired","bid_prices","shift","html","init_state","transWin","display_name","minWidth","minHeight","view","unbind","events","off","on_proposal_open_contract","onclose","on","resize","bind","is_different_stream","sell_at_market","sell_at_market_enabled","price","buy_price","longcode","currency","state_confirm","sold_for","return_percent","balance","balance_after","$html","after","view_confirm","route","update","loading","h","container","transactionChart","setSize","hasUserSize","showLoading","hideLoading","is_settleable","is_sold_at_market","isLookback","contract_type","lb_formula","formula","multiplier","formatPrice","get_chart_data","update_live_chart","key","keyFor","handle_chartingRequestMap","on_tick_cb","on_candles_cb","clean_up_done","clean_up","handle_tick","handle_candle","req","make_chartingRequestMap_request","register","tick","add_tick_to_chart","addPoint","quote","data_key","ohlc","last","open_time","unregister","remove_barriers","add_barriers_to_chart","barrier_label","add_plot_line_y","high_barrier_label","low_barrier_label","removePlotLine","duration","utc","unix","purchase_time","make_granularity","margin","make_time_margin","tick_history_request","make_tick_history_request","on_tick_history_success","on_tick_history_error","make_end","request","make_chart_options"],"mappings":"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","file":"viewTransaction.js","sourcesContent":["﻿import $ from 'jquery';\nimport windows from 'windows/windows';\nimport liveapi from 'websockets/binary_websockets';\nimport chartingRequestMap from 'charts/chartingRequestMap';\nimport rv from 'common/rivetsExtra';\nimport moment from 'moment';\nimport 'common/util';\nimport Lookback from 'trade/lookback';\n\nconst open_dialogs = {};\nconst DISPLAY_DECIMALS = 3;\nconst NOTE_TEXT = {\n  EXPIRED: 'This contract has expired'.i18n(),\n  MARKET_RATE: 'Note: Contract will be sold at the prevailing market price when the request is received by our servers. This price may differ from the indicated price.'.i18n(),\n  NO_RESALE: 'Resale of this contract is not offered'.i18n(),\n  FINISHED: 'This contract has expired'.i18n(),\n};\n\nrequire(['css!viewtransaction/viewTransaction.css']);\nrequire(['text!viewtransaction/viewTransaction.html']);\n\nlet market_data_disruption_win = null;\nconst show_market_data_disruption_win = (proposal) => {\n   if (market_data_disruption_win) {\n      market_data_disruption_win.moveToTop();\n      return;\n   }\n   const market_disrupt_msg = 'There was a market data disruption during the contract period. For real-money accounts we will attempt to correct this and settle the contract properly, otherwise the contract will be cancelled and refunded. Virtual-money contracts will be cancelled and refunded.'.i18n();\n   const root = $('<div class=\"data-disruption-dialog\">' + market_disrupt_msg + '</div>');\n\n   market_data_disruption_win = windows.createBlankWindow(root, {\n      title: ' There was an error '.i18n(),\n      height: 200,\n      resizable:false,\n      collapsable:false,\n      minimizable: false,\n      maximizable: false,\n      destroy: () => {\n         market_data_disruption_win && market_data_disruption_win.dialog('destroy').remove();\n         market_data_disruption_win = null;\n      },\n      'data-authorized': 'true'\n   });\n\n   market_data_disruption_win.dialog('open');\n   window.dd = market_data_disruption_win;\n};\n\nconst init_chart = (root, state, options) => {\n   let data = [];\n   let type = '';\n   let decimal_digits = 0;\n\n   if (options.history) {\n      type = 'line';\n      const { history } = options;\n      const { times, prices } = history;\n\n      for (let i = 0; i < times.length; ++i) {\n         data.push([times[i] * 1000, prices[i] * 1]);\n         decimal_digits = Math.max(decimal_digits, prices[i].substring(prices[i].indexOf('.') + 1).length);\n      }\n   }\n\n   if (options.candles) {\n      type = 'candlestick';\n      data = options.candles.map((c) => [c.epoch * 1000, c.open * 1, c.high * 1, c.low * 1, c.close * 1]);\n   }\n\n   const { title } = options;\n   const el = root.find('.transaction-chart')[0];\n   const chart_options = {\n      credits: { href: '#', text: '' },\n      chart: {\n         type: 'line',\n         renderTo: el,\n         backgroundColor: null, /* make background transparent */\n         width: 0,\n         height: 0,\n         marginLeft:20,\n         marginRight:20\n      },\n      title: { text: '' },\n      tooltip: {\n         xDateFormat:'%A, %b %e, %H:%M:%S GMT',\n         valueDecimals: decimal_digits || undefined,\n      },\n      xAxis: {\n         type: 'datetime',\n         categories:null,\n         startOnTick: false,\n         endOnTick: false,\n         min: data.length ? data[0][0] : null,\n         max: data.length ? data[data.length - 1][0] : null,\n         labels: { overflow:\"justify\", format:\"{value:%H:%M:%S}\" },\n      },\n      yAxis: {\n        labels: {\n          align: 'left',\n          x: 0,\n          y: -2,\n          formatter() {\n            return addComma(this.value.toFixed(DISPLAY_DECIMALS));\n          },\n        },\n         title: '',\n      },\n      series: [{\n         name: title,\n         data: data,\n         type: type\n      }],\n      exporting: { enabled: false, enableImages: false},\n      legend: { enabled: false},\n      navigator: { enabled: true },\n      plotOptions: {\n         line: {\n            marker: { radius: 2 }\n         },\n         candlestick: {\n            lineColor: 'black',\n            color: 'red',\n            upColor: 'green',\n            upLineColor: 'black',\n            shadow: true\n         },\n      },\n      rangeSelector: { enabled: false },\n   };\n   const chart = new Highcharts.Chart(chart_options);\n\n   chart.addPlotLineX = (options) => {\n      chart.xAxis[0].addPlotLine({\n         value: options.value,\n         id: options.id || options.value,\n         label: { text: (options.label || 'label'), x: options.text_left ? -15 : 5},\n         color: options.color || '#e98024',\n         zIndex: 4,\n         width: options.width || 2,\n         dashStyle: options.dashStyle,\n      });\n   };\n\n   chart.addPlotLineY = (options) => {\n      chart.yAxis[0].addPlotLine({\n         id: options.id || options.label,\n         value: options.value,\n         label: { text: options.label, align: 'center', y: options.text_under ? 15 : -5 },\n         color: options.color || 'green',\n         zIndex: 4,\n         width: 2,\n      });\n   };\n   return el.chart = chart;\n};\n\nconst get_tick_value = (symbol, epoch) => {\n   return liveapi.send({ ticks_history: symbol, granularity: 0, style:'ticks', start: epoch, end: epoch + 2, count: 1 })\n      .catch((err) => console.error(err));\n};\n\nexport const init = (contract_id, transaction_id) => {\n   return new Promise((resolve, reject) => {\n      if (open_dialogs[transaction_id]) {\n         open_dialogs[transaction_id].moveToTop();\n         resolve();\n         return;\n      }\n      liveapi.send({proposal_open_contract: 1, contract_id})\n        .then((data) => {\n            const proposal = data.proposal_open_contract;\n            /* check for market data disruption error */\n            if (proposal.underlying === undefined && proposal.shortcode === undefined) {\n               show_market_data_disruption_win(proposal);\n               return;\n            }\n            proposal.transaction_id = transaction_id;\n            init_dialog(proposal);\n            resolve();\n         })\n         .catch((err) => {\n            console.error(err);\n            $.growl.error({ message: err.message });\n            reject();\n         });\n   });\n};\n\nconst handle_error = (message) => {\n  $.growl.error({ message });\n  liveapi.proposal_open_contract.forget(data.echo_req.contract_id);\n  liveapi.proposal_open_contract.subscribe(data.echo_req.contract_id);\n};\n\nconst update_indicative = (data, state) => {\n  const contract = data.proposal_open_contract;\n\n  update_state(contract, state);\n  draw_chart(contract, state)\n\n  const contract_has_finished = contract.status !== 'open';\n  if (contract_has_finished) {\n    on_contract_finished(state);\n    return;\n  }\n\n  update_state_sell();\n  handle_forward_starting();\n  state.chart.manual_reflow();\n\n  function update_state(contract, state) {\n    // note: rivets.js 2-way data-binding breaks with spread operator assignment\n    state.proposal_open_contract.user_sold = contract.sell_spot_time && contract.sell_spot_time < contract.date_expiry;\n    state.proposal_open_contract.current_spot = contract.current_spot;\n    state.proposal_open_contract.current_spot_time = contract.current_spot_time;\n    state.proposal_open_contract.bid_price = contract.bid_price;\n    state.proposal_open_contract.entry_tick = contract.entry_tick;\n    state.proposal_open_contract.entry_tick_time = contract.entry_tick_time;\n    state.proposal_open_contract.status = contract.status;\n    state.proposal_open_contract.is_sold = contract.is_sold;\n    state.proposal_open_contract.exit_tick = contract.exit_tick;\n    state.proposal_open_contract.exit_tick_time = contract.exit_tick_time;\n    state.proposal_open_contract.date_expiry = contract.date_expiry;\n    state.proposal_open_contract.sell_price = contract.sell_price;\n    state.proposal_open_contract.is_valid_to_sell = contract.is_valid_to_sell;\n    state.proposal_open_contract.barrier = contract.barrier;\n    state.proposal_open_contract.high_barrier = contract.high_barrier;\n    state.proposal_open_contract.low_barrier = contract.low_barrier;\n\n    state.note = make_note(contract);\n  }\n\n  function update_state_sell() {\n    if (contract.bid_price) {\n      state.sell.bid_price.value = contract.bid_price;\n      [state.sell.bid_price.unit, state.sell.bid_price.cent] = contract.bid_price.toString().split(/[\\.,]+/);\n    }\n  }\n\n  function handle_forward_starting() {\n    const constract_is_forward_starting = contract.is_forward_starting && +contract.date_start > +contract.current_spot_time;\n    if (constract_is_forward_starting) {\n      state.fwd_starting = '* Contract has not started yet'.i18n();\n      return;\n    }\n    state.fwd_starting = '';\n  }\n};\n\nfunction draw_chart(contract, state) {\n  draw_sparkline(contract, state);\n\n  const { chart } = state.chart;\n  if (!chart) return;\n\n  draw_vertical_lines(contract, state, chart);\n  draw_barrier(contract, state);\n}\n\nfunction draw_vertical_lines(contract, state, chart) {\n  const { entry_tick_time, sell_spot_time, exit_tick_time, date_expiry, date_start } = contract;\n  const text_left = true;\n\n  draw_entry_spot(entry_tick_time);\n  draw_start_time(date_start, text_left);\n\n  draw_exit_spot(sell_spot_time, exit_tick_time, text_left);\n  draw_end_time(date_expiry);\n\n  function draw_entry_spot(entry_tick_time) {\n    const label = 'Entry Spot'.i18n();\n    if (!entry_tick_time || chart_has_label(label)) return;\n    chart.addPlotLineX({ value: entry_tick_time * 1000, label });\n  }\n\n  function draw_exit_spot(sell_spot_time, exit_tick_time, text_left) {\n    const label = 'Exit Spot'.i18n();\n    const contract_has_no_exit_time = !sell_spot_time && !exit_tick_time;\n    if (contract_has_no_exit_time || chart_has_label(label)) return;\n\n    let value;\n    if (!!contract.is_path_dependent || contract.status === 'sold') {\n      value = sell_spot_time * 1000;\n    } else {\n      value = exit_tick_time * 1000;\n    }\n\n    chart.addPlotLineX({ value, label, text_left, dashStyle: 'Dash' });\n  }\n\n  function draw_end_time(date_expiry) {\n    const label = 'End Time'.i18n();\n    if (!date_expiry || chart_has_label(label)) return false;\n\n    chart.addPlotLineX({ value: date_expiry * 1000, label, dashStyle: 'Dash' });\n  }\n\n  function draw_start_time(date_start, text_left) {\n    const label = 'Start Time'.i18n();\n    if (!date_start || chart_has_label(label)) return;\n    chart.addPlotLineX({ value: date_start * 1000, label, text_left });\n  }\n\n  function chart_has_label(label) {\n    if (state.chart.added_labels.includes(label)) return true;\n\n    state.chart.added_labels.push(label);\n    return false;\n  }\n}\n\nconst on_contract_finished = (state) => {\n  state.proposal_open_contract.is_ended = true;\n};\n\nconst make_note = (contract) => {\n    if (contract.validation_error) return contract.validation_error;\n    if (contract.status !== 'open') return NOTE_TEXT.FINISHED;\n    if (contract.is_expired || contract.is_sold) return NOTE_TEXT.EXPIRED;\n    if (contract.is_valid_to_sell) return NOTE_TEXT.MARKET_RATE;\n    if (!contract.is_valid_to_sell) return NOTE_TEXT.NO_RESALE;\n};\n\nconst draw_sparkline = (contract, state) => {\n  if (state.sell.bid_prices.length > 40) {\n    state.sell.bid_prices.shift();\n  }\n  state.sell.bid_prices.push(contract.bid_price);\n};\n\nconst init_dialog = (proposal) => {\n   require(['text!viewtransaction/viewTransaction.html'], (html) => {\n      const root = $(html).i18n();\n      const state = init_state(proposal, root);\n\n      const transWin = windows.createBlankWindow(root, {\n         title: proposal.display_name + ' (' + proposal.transaction_id + ')',\n         width: 700,\n         minWidth: 490,\n         minHeight: 480,\n         height: 480,\n         destroy: () => { },\n         close: function() {\n            view && view.unbind();\n            liveapi.proposal_open_contract.forget(proposal.contract_id);\n            liveapi.events.off('proposal_open_contract', on_proposal_open_contract);\n            for(let i = 0; i < state.onclose.length; ++i)\n               state.onclose[i]();\n            $(this).dialog('destroy').remove();\n            open_dialogs[proposal.transaction_id] = undefined;\n         },\n         open: () => {\n            liveapi.proposal_open_contract.subscribe(proposal.contract_id);\n            liveapi.events.on('proposal_open_contract', on_proposal_open_contract);\n         },\n         resize: () => {\n            state.chart.manual_reflow();\n         },\n         'data-authorized': 'true'\n      });\n\n      transWin.dialog('open');\n      const view = rv.bind(root[0],state)\n      open_dialogs[proposal.transaction_id] = transWin;\n\n      function on_proposal_open_contract(data) {\n        const is_different_stream = +data.proposal_open_contract.contract_id !== +state.proposal_open_contract.contract_id;\n        if (is_different_stream) return;\n\n        if (data.error) {\n          handle_error(data.error.message);\n          return;\n        }\n\n        update_indicative(data, state)\n      }\n   });\n};\n\nconst sell_at_market = (state, root) => {\n   state.sell.sell_at_market_enabled = false;\n   require(['text!viewtransaction/viewTransactionConfirm.html', 'css!viewtransaction/viewTransactionConfirm.css']);\n   liveapi.send({ sell: state.proposal_open_contract.contract_id, price: 0 })\n      .then((data) => {\n         state.proposal_open_contract.user_sold = true;\n         const { sell } = data;\n         require(['text!viewtransaction/viewTransactionConfirm.html', 'css!viewtransaction/viewTransactionConfirm.css'],\n            (html) => {\n               const { buy_price, longcode, currency } = state.proposal_open_contract;\n               const state_confirm = {\n                  longcode,\n                  buy_price,\n                  sell_price: sell.sold_for,\n                  return_percent: (100 * (sell.sold_for - buy_price) / buy_price).toFixed(2) + '%',\n                  transaction_id: sell.transaction_id,\n                  balance: sell.balance_after,\n                  currency,\n               };\n               const $html = $(html).i18n();\n               root.after($html);\n               const view_confirm = rv.bind($html[0], state_confirm);\n               state.onclose.push(() => {\n                  view_confirm && view_confirm.unbind();\n               });\n            });\n      })\n      .catch((err) => {\n         $.growl.error({ message: err.message });\n         console.error(err);\n      });\n};\n\nconst init_state = (proposal, root) => {\n   const state = {\n      route: {\n         value: 'table',\n         update: (value) => { state.route.value = value; },\n      },\n      note: make_note(proposal),\n      chart: {\n         chart: null, /* highchart object */\n         loading: 'Loading ' + proposal.display_name + ' ...',\n         added_labels: [],\n         type: 'ticks', // could be 'tick' or 'ohlc'\n         manual_reflow: () => {\n          if (!state.chart.chart) return;\n\n          const h = -1 * (root.find('.longcode').height() + root.find('.tabs').height() + root.find('.footer').height()) - 16;\n          const container = root;\n          const transactionChart = container.find(\".transaction-chart\");\n          const width = container.width() - 10;\n          const height = container.height();\n\n          state.chart.chart.setSize(width, height + h , false);\n          state.chart.chart.hasUserSize = null;\n          if (state.chart.chart.series[0] && state.chart.chart.series[0].data.length === 0) {\n            state.chart.chart.showLoading();\n            return;\n          }\n          state.chart.chart.hideLoading();\n       },\n      },\n      proposal_open_contract: {\n        ...proposal,\n        currency: (proposal.currency ||  'USD') + ' ',\n        is_ended: proposal.is_settleable || proposal.is_sold || proposal.status !== 'open',\n        is_sold_at_market: false,\n        user_sold: proposal.sell_spot_time && proposal.sell_spot_time < proposal.date_expiry,\n        isLookback: Lookback.isLookback(proposal.contract_type),\n        lb_formula: Lookback.formula(proposal.contract_type, proposal.multiplier && formatPrice(proposal.multiplier, proposal.currency ||  'USD')),\n      },\n      sell: {\n         bid_prices: [],\n         bid_price: {\n            unit: undefined,\n            cent: undefined,\n            value: undefined,\n         },\n         sell: () => sell_at_market(state, root),\n         sell_at_market_enabled: true,\n      },\n      onclose: [], /* cleanup callback array when dialog is closed */\n   };\n   get_chart_data(state, root);\n   return state;\n};\n\nconst update_live_chart = (state, granularity) => {\n  const key = chartingRequestMap.keyFor(state.proposal_open_contract.underlying, granularity);\n  handle_chartingRequestMap(key);\n\n  let on_tick_cb = undefined;\n  let on_candles_cb = undefined;\n  let clean_up_done = false;\n  state.onclose.push(clean_up);\n\n  if (granularity === 0) {\n    handle_tick();\n    return;\n  }\n  handle_candle();\n\n  /* don't register if already someone else has registered for this symbol */\n  function handle_chartingRequestMap() {\n    if(!chartingRequestMap[key]){\n      const req = make_chartingRequestMap_request(granularity, state.proposal_open_contract.underlying);\n      chartingRequestMap.register(req)\n          .catch((err) => {\n            $.growl.error({ message: err.message });\n            console.error(err);\n          });\n    } else {\n      chartingRequestMap.subscribe(key);\n    }\n  }\n\n  function make_chartingRequestMap_request(granularity, symbol) {\n    return ({\n      symbol,\n      subscribe: 1,\n      granularity,\n      style: granularity === 0 ? 'ticks' : 'candles',\n    });\n  }\n\n  function handle_tick() {\n    on_tick_cb = liveapi.events.on('tick', (data) => {\n        if (!data.tick || data.tick.symbol !== state.proposal_open_contract.underlying) return;\n\n        const { chart } = state.chart;\n        const { status } = state.proposal_open_contract;\n        const { tick } = data;\n\n        const contract_has_finished = !!state.proposal_open_contract.is_sold || status !== 'open';\n        if (contract_has_finished) {\n          clean_up();\n          return;\n        };\n\n        add_tick_to_chart(chart, tick);\n    });\n\n    function add_tick_to_chart(chart, tick) {\n      if (!chart) return;\n      chart.series[0].addPoint([tick.epoch * 1000, tick.quote * 1]);\n    }\n  }\n\n  function handle_candle() {\n    on_candles_cb = liveapi.events.on('ohlc', (data) => {\n      const data_key = chartingRequestMap.keyFor(data.ohlc.symbol, data.ohlc.granularity);\n      if (key !== data_key) return;\n\n      const { chart } = state.chart;\n      if (!chart) return;\n\n      const series = chart.series[0];\n      const last = series.data[series.data.length - 1];\n\n      const c = data.ohlc;\n      const ohlc = [c.open_time * 1000, c.open * 1, c.high * 1, c.low * 1, c.close * 1];\n\n      if (last.x !== ohlc[0]) {\n          series.addPoint(ohlc, true, true);\n      } else {\n        last.update(ohlc,true);\n      }\n\n      const contract_has_finished = c.epoch * 1 > state.proposal_open_contract.date_expiry * 1;\n      if (contract_has_finished) clean_up();\n    });\n  }\n\n  function clean_up() {\n    if (clean_up_done) return;\n    clean_up_done = true;\n\n    chartingRequestMap.unregister(key);\n    on_tick_cb && liveapi.events.off('tick', on_tick_cb);\n    on_candles_cb && liveapi.events.off('candles', on_candles_cb);\n  }\n};\n\nconst draw_barrier = (contract, state) => {\n  const { chart } = state.chart;\n  const { barrier, high_barrier, low_barrier } = state.proposal_open_contract;\n\n  remove_barriers(barrier, high_barrier, low_barrier);\n  add_barriers_to_chart(barrier, high_barrier, low_barrier);\n\n  function add_barriers_to_chart(barrier, high_barrier, low_barrier ) {\n    if (barrier) {\n      const barrier_label = `${ 'Barrier'.i18n()} ( ${addComma((+barrier).toFixed(DISPLAY_DECIMALS))} )`;\n      add_plot_line_y('barrier', barrier, barrier_label);\n    }\n    if (high_barrier) {\n      const high_barrier_label = `${'High Barrier'.i18n()} ( ${addComma((+high_barrier).toFixed(DISPLAY_DECIMALS))} )`;\n      add_plot_line_y('high_barrier', high_barrier, high_barrier_label);\n    }\n    if (low_barrier) {\n      const low_barrier_label = `${'Low Barrier'.i18n()} ( ${addComma((+low_barrier).toFixed(DISPLAY_DECIMALS))} )`;\n      add_plot_line_y('low_barrier', low_barrier, low_barrier_label, 'red', true );\n    }\n\n    function add_plot_line_y(id, value, label, color, text_under) {\n      chart.addPlotLineY({ id, value, label, color, text_under });\n    };\n  }\n\n  function remove_barriers(barrier, high_barrier, low_barrier) {\n    barrier && chart.yAxis[0].removePlotLine('barrier');\n    high_barrier && chart.yAxis[0].removePlotLine('high_barrier');\n    low_barrier && chart.yAxis[0].removePlotLine('low_barrier');\n  }\n}\n\nconst get_chart_data = (state, root) => {\n  const duration = Math.min(+state.proposal_open_contract.date_expiry, moment.utc().unix()) - (state.proposal_open_contract.purchase_time || state.proposal_open_contract.date_start);\n  const granularity = make_granularity(duration);\n  const margin = make_time_margin(duration, granularity);\n  const tick_history_request = make_tick_history_request(granularity, margin);\n\n   if (!state.proposal_open_contract.is_ended) {\n      update_live_chart(state, granularity);\n   }\n\n  return liveapi.send(tick_history_request).then((data) => {\n      on_tick_history_success(data);\n    })\n    .catch((err) => {\n      on_tick_history_error(err);\n    });\n\n  function make_granularity(duration) {\n    let granularity = 0;\n\n    if (duration <= 60 * 60) { granularity = 0; } // 1 hour\n    else if (duration <= 2 * 60 * 60) { granularity = 60; } // 2 hours\n    else if (duration <= 6 * 60 * 60) { granularity = 120; } // 6 hours\n    else if (duration <= 24 * 60 * 60) { granularity = 300; } // 1 day\n    else { granularity = 3600 } // more than 1 day\n    return granularity;\n  }\n\n  function make_time_margin(duration, granularity) {\n    let margin = 0;\n    margin = (granularity === 0) ? Math.max(3, 30 * duration / (60 * 60) | 0) : 3 * granularity;\n    return margin;\n  }\n\n  function make_tick_history_request(granularity, margin) {\n    const end = make_end(margin);\n    const request = {\n      ticks_history: state.proposal_open_contract.underlying,\n      start: (+state.proposal_open_contract.date_start || +state.proposal_open_contract.purchase_time) - margin, /* load around 2 more thicks before start */\n      end,\n      style: 'ticks',\n      count: 4999, /* maximum number of ticks possible */\n    };\n\n    if (granularity !== 0) {\n      request.granularity = granularity;\n      request.style = 'candles';\n      state.chart.type = 'candles';\n    }\n    return request;\n\n    function make_end(margin) {\n      const { sell_spot_time, exit_tick_time } = state.proposal_open_contract;\n\n      if (sell_spot_time) return (+sell_spot_time + margin);\n      if (exit_tick_time) return (+exit_tick_time + margin);\n      return 'latest';\n    }\n  }\n\n\n  function on_tick_history_success(data) {\n    state.chart.loading = '';\n\n    const chart_options = make_chart_options(data, state.proposal_open_contract.display_name);\n    const chart = init_chart(root, state, chart_options);\n    state.chart.chart = chart;\n    state.chart.manual_reflow();\n\n    function make_chart_options(data, title) {\n      return ({ title, ...data });\n    }\n  }\n\n  function on_tick_history_error(err) {\n    state.chart.loading = err.message;\n    console.error(err);\n  }\n};\n\nexport default  { init };\n"]}