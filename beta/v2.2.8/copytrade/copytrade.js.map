{"version":3,"sources":["../../../../src/copytrade/copytrade.es6"],"names":["getLoggedInUserId","local_storage","get","id","TRADE_TYPES","trade_types","form_error_messages","INVALID_STAKE_LIMIT","i18n","TOKEN_ALREADY_ADDED","ENTER_VALID_TOKEN","REFRESH_FAILED","getStorageName","mapCodeToApiCode","selected_trade_types","all_trade_types","filter","includes","trade_type","code","map","filtered_trade_type","api_code","DEFAULT_TRADE_TYPES","slice","m","defaultCopySettings","traderApiToken","copy_start","min_trade_stake","max_trade_stake","assets","_","cloneDeep","DEFAULT_ASSETS","defaultTraderDetails","loginid","open","started","disableStart","yourCopySettings","validate_min_max_stake","yourCopySettingsData","updateLocalStorage","debounce","clonedScope","scope","searchToken","disable","set","GROUPED_INTRUMENTS","then","flatten","instruments","displayName","display_name","submarkets","mm","forEach","eGrp","eSubGrp","symbol","push","name","state","masterAssetList","groupedAssets","f","refreshTraderStats","token","liveapi","send","copytrading_statistics","trader_id","copyStatData","traderTokenDetails","find","traderTokens","merge","traderStatistics","catch","e","$","growl","error","message","win","win_view","masterTradeTypeList","is_loading","is_virtual","allowCopy","allow_copiers","onAllowCopyChangeCopierCellClick","onChangeCopytradeSettings","onAllowCopyChangeTraderCellClick","set_settings","settings","onOpenChange","index","onStartedChange","newStarted","fromLocalStorage","currentTraderTokenDetails_localSto","newObj","splice","defer","settingsToSend","length","disableKeypressChars","copy_stop","onRemove","toBeRemovedItem","onRefresh","trader","disableRefresh","onMinTradeChange","event","formatAndSetTradeStake","onMaxTradeChange","type_trade_stake","target","data","value","format_amount","isNil","match","onUpdateYourSettings","notice","onTokenChange","onKeyDown","keyCode","addToken","some","tokenUserData","Error","openTokenMgmt","click","initConfigWindow","root","html","rv","bind","windows","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","modal","width","copyTrade","isVirtual","get_settings","traderToken","console","close","unbind","dialog","remove","track","module_id","is_unique","input_el_ids","comma_separated_ids","join","keypress","evt","which","preventDefault","init","$menuLink","moveToTop"],"mappings":"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","file":"copytrade.js","sourcesContent":["import $ from 'jquery';\nimport windows from '../windows/windows';\nimport rv from '../common/rivetsExtra';\nimport _ from 'lodash';\nimport html from 'text!./copytrade.html';\nimport 'css!./copytrade.css';\nimport { trade_types } from '../common/common';\nimport '../common/util';\nimport liveapi from 'websockets/binary_websockets';\nimport validateToken from 'websockets/validateToken';\nimport { init as instrumentPromise } from '../instruments/instruments';\n\n// While using copy trader, this cannot be NULL\nconst getLoggedInUserId = () => local_storage.get(\"oauth\")[0].id;\n\nconst TRADE_TYPES = trade_types;\n\nconst form_error_messages = {\n    INVALID_STAKE_LIMIT: 'Min trade stake should be lower than max trade stake.'.i18n(),\n    TOKEN_ALREADY_ADDED: 'Token already added'.i18n(),\n    ENTER_VALID_TOKEN: 'Enter a valid trader token'.i18n(),\n    REFRESH_FAILED: 'Refresh failed'.i18n(),\n};\n\nconst getStorageName = () => `copyTrade_${getLoggedInUserId()}`;\n\nconst mapCodeToApiCode = (selected_trade_types = [], all_trade_types) => \n  all_trade_types\n    .filter(trade_type => selected_trade_types.includes(trade_type.code))\n    .map(filtered_trade_type => filtered_trade_type.api_code);\n\nconst DEFAULT_TRADE_TYPES = TRADE_TYPES.slice(0, 2).map(m => m.code);\n\nconst defaultCopySettings = (traderApiToken) => ({\n  copy_start: traderApiToken,\n  min_trade_stake: 10,\n  max_trade_stake: 100,\n  assets: _.cloneDeep(DEFAULT_ASSETS),\n  trade_types: _.cloneDeep(DEFAULT_TRADE_TYPES),\n});\n\nconst defaultTraderDetails = (traderApiToken, loginid) => ({\n  open: false,\n  started: false,\n  disableStart: false,\n  loginid,\n  yourCopySettings: defaultCopySettings(traderApiToken),\n});\n\nconst validate_min_max_stake = (yourCopySettingsData) => {\n  const { min_trade_stake, max_trade_stake } = yourCopySettingsData;\n  if (min_trade_stake > max_trade_stake) {\n    return false;\n  }\n  return true;\n};\n\nconst updateLocalStorage = _.debounce(scope => {\n  const clonedScope = _.cloneDeep(scope);\n  delete clonedScope.searchToken.disable;\n  local_storage.set(getStorageName(), clonedScope);\n}, 50);\n\nlet GROUPED_INTRUMENTS = null; // For nice display purpose only\nlet DEFAULT_ASSETS = null;\n//Get instrument list\ninstrumentPromise().then(instruments => {\n  GROUPED_INTRUMENTS = _.flatten(instruments.map(m => {\n    const displayName = m.display_name;\n    return m.submarkets.map(mm => ({\n      displayName: `${displayName} - ${mm.display_name}`,\n      instruments: mm.instruments,\n    }));\n  }));\n  let assets = [];\n  instruments.forEach(eGrp => {\n    eGrp.submarkets.forEach(eSubGrp => {\n      eSubGrp.instruments.forEach(({ symbol, display_name }) => {\n        assets.push({\n          code: symbol,\n          name: display_name,\n        });\n      });\n    });\n  });\n  state.masterAssetList = assets;\n  state.groupedAssets = GROUPED_INTRUMENTS;\n  // Randomly add top 2 assets in default list\n  DEFAULT_ASSETS = assets.filter(f => f.code === 'R_10').map(m => m.code);\n});\n\nconst refreshTraderStats = (loginid, token, scope) => {\n  liveapi\n  .send({\n    copytrading_statistics: 1,\n    trader_id: loginid,\n  })\n  .then((copyStatData) => {\n    if (copyStatData.copytrading_statistics) {\n      const traderTokenDetails = _.find(scope.traderTokens, f =>\n        f.yourCopySettings && f.yourCopySettings.copy_start === token);\n      //Check if we already added this trader. If yes, then merge the changes\n      if (traderTokenDetails) {\n        _.merge(traderTokenDetails.traderStatistics, copyStatData.copytrading_statistics);\n      }\n      //If not added, then add this along with default yourCopySettings object\n      else {\n        scope.traderTokens.push(_.merge({\n          traderStatistics: copyStatData.copytrading_statistics,\n        }, defaultTraderDetails(token, loginid)));\n      }\n    }\n    updateLocalStorage(scope);\n  }).catch((e) => {\n    $.growl.error({ message: e.message });\n  });\n};\n\nlet win = null, win_view = null;\n\nconst state = {\n  masterAssetList: [],\n  masterTradeTypeList: _.cloneDeep(TRADE_TYPES),\n  groupedAssets: [],\n  is_loading: true,\n  is_virtual: true,\n  allowCopy: {\n    allow_copiers: 0,\n    onAllowCopyChangeCopierCellClick: () => state.onChangeCopytradeSettings(0),\n    onAllowCopyChangeTraderCellClick: () => state.onChangeCopytradeSettings(1),\n  },\n  onChangeCopytradeSettings: _.debounce((allow_copiers) => {\n    if (state.is_virtual) return;\n    if (state.allowCopy.allow_copiers === allow_copiers) return;\n\n    state.is_loading = true;\n\n    liveapi\n      .send({\n        set_settings: 1,\n        allow_copiers,\n      })\n      // set_settings api res does not have updated settings\n      .then((settings) => {\n        state.is_loading = false;\n        state.allowCopy.allow_copiers = allow_copiers;\n      })\n      .catch(e => {\n        state.is_loading = false;\n        $.growl.error({ message: e.message });\n      });\n  }, 250),\n  onOpenChange: (index) => {\n    state.traderTokens[index].open = !state.traderTokens[index].open;\n  },\n  onStartedChange: (index) => {\n    state.traderTokens[index].disableStart = true;\n    const newStarted = !state.traderTokens[index].started;\n    if (newStarted) {\n      //Start copying\n      //if started, revert back to last saved changes(in case user changed anything)\n      const fromLocalStorage = local_storage.get(getStorageName());\n      if (fromLocalStorage) {\n        const currentTraderTokenDetails_localSto = fromLocalStorage.traderTokens[index];\n        if (currentTraderTokenDetails_localSto) {\n          const newObj = {};\n          _.merge(newObj, state.traderTokens[index], currentTraderTokenDetails_localSto);\n          state.traderTokens.splice(index, 1);\n          //Have to apply this trick in order to trigger update of UI using rivetsjs.\n          _.defer(() => {\n            state.traderTokens.splice(index, 0, newObj);\n            const settingsToSend = _.cloneDeep(newObj.yourCopySettings);\n            if (!settingsToSend.min_trade_stake) delete settingsToSend.min_trade_stake;\n            if (!settingsToSend.max_trade_stake) delete settingsToSend.max_trade_stake;\n            if (!settingsToSend.assets || settingsToSend.assets.length <= 0) delete settingsToSend.assets;\n            settingsToSend.trade_types = mapCodeToApiCode(settingsToSend.trade_types, TRADE_TYPES);\n\n            liveapi\n              .send(settingsToSend)\n              .then(() => {\n                newObj.disableStart = false;\n                newObj.started = true;\n                disableKeypressChars('#max_trade_stake', '#min_trade_stake');\n                updateLocalStorage(state);\n              })\n              .catch(e => {\n                $.growl.error({ message: e.message });\n                newObj.disableStart = false;\n                disableKeypressChars('#max_trade_stake', '#min_trade_stake');\n                updateLocalStorage(state);\n              });\n          });\n        }\n      }\n    } else {\n      //Stop copying\n      liveapi.send({\n          copy_stop: state.traderTokens[index].yourCopySettings.copy_start\n        })\n        .then(() => {\n          state.traderTokens[index].disableStart = false;\n          state.traderTokens[index].started = false;\n          updateLocalStorage(state);\n        })\n        .catch(e => {\n          $.growl.error({ message: e.message });\n          state.traderTokens[index].disableStart = false;\n          updateLocalStorage(state);\n        });\n    }\n  },\n  onRemove: (index) => {\n    const toBeRemovedItem = state.traderTokens[index];\n    state.traderTokens.splice(index, 1);\n    updateLocalStorage(state);\n    liveapi.send({\n      copy_stop: toBeRemovedItem.yourCopySettings.copy_start\n    })\n    .catch(e => {});\n  },\n  onRefresh: (index) => {\n    const trader = state.traderTokens[index];\n    const loginid = trader.loginid;\n    const token = trader.yourCopySettings.copy_start;\n    if (loginid && token) {\n      trader.disableRefresh = true;\n      refreshTraderStats(loginid, token, state)\n        .then(() => {\n          trader.disableRefresh = false;\n          updateLocalStorage(state);\n        })\n        .catch((e) => {\n          $.growl.error({ message: form_error_messages.REFRESH_FAILED });\n          trader.disableRefresh = false;\n          updateLocalStorage(scope);\n        });\n    }\n  },\n  onMinTradeChange: (event, scope) => {\n    state.formatAndSetTradeStake(event, scope, 'min_trade_stake')\n  },\n  onMaxTradeChange: (event, scope) => {\n    state.formatAndSetTradeStake(event, scope, 'max_trade_stake')\n  },\n  formatAndSetTradeStake: (event, scope, type_trade_stake) => {\n    const index = $(event.target).data('index');\n    const value = event.target.value;\n    const format_amount = _.isNil(value) ? false : value.match(/0*(\\d+\\.?\\d{0,2})/);\n    if (format_amount) {\n      scope.traderTokens[index].yourCopySettings[type_trade_stake] = format_amount[1];\n    } else {\n      scope.traderTokens[index].yourCopySettings[type_trade_stake] = '';\n    }\n  },\n  onUpdateYourSettings: (index) => {\n    if (validate_min_max_stake(state.traderTokens[index].yourCopySettings)) {\n      updateLocalStorage(state);\n      $.growl.notice({ message: 'Updated successfully' });\n    } else {\n      $.growl.error({ message: form_error_messages.INVALID_STAKE_LIMIT });\n    }\n  },\n  searchToken: {\n    token: '',\n    onTokenChange: (event, scope) => scope.searchToken.token = event.target.value,\n    disable: false,\n    onKeyDown: (event, scope) => {\n      if (event.keyCode === 13) {\n        scope.searchToken.addToken(event, scope);\n      }\n    },\n    addToken: (event, scope) => {\n      //If searchToken.token is empty, do nothing\n      if (!scope.searchToken.token) {\n        $.growl.error({ message: form_error_messages.ENTER_VALID_TOKEN });\n        return;\n      }\n\n      //If already added, throw error\n      if (_.some(state.traderTokens, f => f.yourCopySettings.copy_start === scope.searchToken.token)) {\n        $.growl.error({ message: form_error_messages.TOKEN_ALREADY_ADDED });\n        return;\n      }\n\n      scope.searchToken.disable = true;\n\n      validateToken(scope.searchToken.token)\n        .then(tokenUserData => {\n          if (!tokenUserData) throw new Error('Invalid token');\n          refreshTraderStats(tokenUserData.loginid, scope.searchToken.token, scope);\n          scope.searchToken.token = '';\n          scope.searchToken.disable = false;\n          updateLocalStorage(scope);\n        })\n        .catch(error => {\n          $.growl.error({ message: error.message });\n          scope.searchToken.disable = false;\n          updateLocalStorage(scope);\n        });\n    },\n  },\n  traderTokens: [],\n  openTokenMgmt: () => $('li.account ul a.token-management').click(),\n};\n\nconst initConfigWindow = () => {\n  const root = $(html).i18n();\n  win_view = rv.bind(root[0], state);\n  win = windows.createBlankWindow(root, {\n    title: 'Copy Trading'.i18n(),\n    resizable: false,\n    collapsable: true,\n    minimizable: true,\n    maximizable: false,\n    modal: false,\n    width: 600,\n    open: () => {\n      //Refresh all token details\n      const copyTrade = local_storage.get(getStorageName());\n      if (copyTrade) {\n        _.merge(state, copyTrade);\n        state.traderTokens = _.cloneDeep(state.traderTokens); // This is needed to trigger rivetsjs render\n      }\n      state.is_loading = true;\n      state.is_virtual = isVirtual();\n      //VRTC can only be copiers\n      if (state.is_virtual) {\n        state.is_loading = false;\n        state.allowCopy.allow_copiers = 0;\n      } else {\n        liveapi\n        .send({ get_settings: 1 })\n        .then((settings) => {\n          state.is_loading = false;\n          state.allowCopy.allow_copiers = settings.get_settings.allow_copiers;\n        })\n        .catch((e) => {\n          state.is_loading = false;\n          $.growl.error({ message: e.message });\n        });\n      }\n      //Refresh locally stored trader statistics\n      if (copyTrade) {\n        (async function () {\n          for (let traderToken of copyTrade.traderTokens) {\n            try {\n              const loginid = traderToken.loginid;\n              const token = traderToken.yourCopySettings.copy_start;\n              await refreshTraderStats(loginid, token, state);\n            } catch (e) {\n              console.error(e);\n            }\n          }\n        })();\n      }\n    },\n    close: () => {\n      win_view && win_view.unbind();\n      win && win.dialog('destroy').remove();\n      win_view = win = null;\n      // Clear tokens\n      state.traderTokens = [];\n    },\n    'data-authorized' :'true',\n  });\n  win.track({\n    module_id: 'copyTrade',\n    is_unique: true,\n    data: null,\n  });\n  win.dialog( 'open' );\n};\n\nconst disableKeypressChars = (...input_el_ids) => {\n  if (input_el_ids.length > 0) {\n    const comma_separated_ids = input_el_ids.join(', ');\n    $(comma_separated_ids).keypress((evt) => {\n      if ((evt.which < 48 || evt.which > 57) && evt.which !== 8 && evt.which !== 46) {\n        evt.preventDefault();\n      }\n    });\n  }\n};\n\nexport const init = ($menuLink) => {\n  $menuLink.click(() => {\n    if (!win) {\n      initConfigWindow();\n      disableKeypressChars('#max_trade_stake', '#min_trade_stake');\n    }\n    else { win.moveToTop(); }\n  });\n};\n\nexport default { init }\n\n"]}